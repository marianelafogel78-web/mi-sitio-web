<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- T√≠tulo de la Aplicaci√≥n -->
    <title>ACCESORIOS DE MODA Y M√ÅS - Tienda Online</title>
    
    <!-- ESTILOS (CSS) - ¬°Actualizado a la paleta LILA SUAVE! -->
    <style>
        /* VARIABLES DE COLORES LILA SUAVE Y TEXTO NEGRO */
        :root {
            --color-fondo: #F8F0FC; /* LILA MUY P√ÅLIDO (CASI BLANCO) */
            --color-primario: #E6E0F8; /* LILA SUAVE (Malva claro) */
            --color-secundario: #D8BFD8; /* LILA (Thistle) - Ligeramente m√°s intenso */
            --color-acento: #FFC0CB; /* ROSA PASTEL (Se mantiene para acento y botones) */
            --color-texto: #000000; /* ¬°NEGRO PURO PARA TODO EL TEXTO! */
            --color-borde: #A9A9A9; /* GRIS OSCURO SUAVE */
        }

        * {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--color-fondo);
            color: var(--color-texto);
            margin: 0;
            padding: 0;
            text-transform: uppercase; /* TODO EN MAY√öSCULAS */
        }

        /* ENCABEZADO */
        header {
            background-color: var(--color-primario); /* LILA SUAVE */
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            color: var(--color-texto); /* ¬°T√çTULO EN NEGRO! */
        }

        /* CONTENEDOR PRINCIPAL */
        main {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h2, h3 {
            /* L√≠nea de separaci√≥n que usa el color secundario lila */
            border-bottom: 2px solid var(--color-secundario);
            padding-bottom: 10px;
            margin-top: 30px;
            color: var(--color-texto); /* ¬°T√çTULOS DE SECCI√ìN EN NEGRO! */
        }
        
        /* ESTILO ESPEC√çFICO PARA EL T√çTULO DE CADA CATEGOR√çA EN LA TIENDA */
        .categoria-titulo {
             /* Usamos el color de fondo para que el t√≠tulo de categor√≠a no tenga el borde de h3 */
            border-bottom: none; 
            margin-bottom: 15px; 
            font-size: 1.8em;
            font-weight: 700;
        }


        section {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* ESTILO DE PRODUCTOS */
        .contenedor-productos {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .producto-card {
            background-color: #F0F8FF; /* AZUL CLARO PASTEL (AliceBlue) */
            border: 1px solid var(--color-borde);
            border-radius: 8px;
            padding: 15px;
            width: calc(33% - 14px); 
            text-align: center;
            transition: transform 0.2s;
        }

        .producto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .producto-card img {
            width: 100%;
            height: 200px; 
            object-fit: cover; 
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .producto-card h4 {
            margin: 5px 0;
            font-size: 1.1em;
            min-height: 40px; 
        }

        .producto-card p.precio {
            font-weight: bold;
            color: var(--color-acento); /* ROSA PASTEL PARA EL PRECIO */
            font-size: 1.2em;
            margin: 10px 0;
        }

        .producto-card button {
            background-color: var(--color-secundario); /* LILA SUAVE para botones */
            color: var(--color-texto);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .producto-card button:hover {
            background-color: #C3B1E1; /* LILA M√ÅS INTENSO AL PASAR EL MOUSE */
        }

        /* CARRITO */
        #lista-carrito {
            margin-bottom: 20px;
            border: 1px dashed var(--color-borde);
            padding: 10px;
        }

        .carrito-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted var(--color-borde);
        }

        .carrito-item:last-child {
            border-bottom: none;
        }

        .carrito-item input {
            width: 50px;
            text-align: center;
            padding: 5px;
            border: 1px solid var(--color-secundario);
            margin: 0 10px;
        }

        #resumen-carrito p {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--color-texto); /* TOTAL TAMBI√âN EN NEGRO */
        }

        /* ESTILO DE BOTONES PRINCIPALES Y ACENTOS (Rosa Pastel) */
        #resumen-carrito button, #btn-login, #btn-guardar-producto, #btn-cancelar-edicion, .btn-admin-categoria {
            padding: 10px 20px;
            margin-right: 10px;
            background-color: var(--color-acento); /* ROSA PASTEL */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: background-color 0.2s;
        }
        
        /* ESTILO ESPEC√çFICO PARA BOTONES PEQUE√ëOS DE CATEGOR√çA */
        .btn-admin-categoria {
            padding: 5px 10px;
            font-size: 0.8em;
            margin-right: 5px;
        }
        
        .btn-eliminar-categoria {
            background-color: #F08080; /* ROJO CLARO */
            color: white;
        }

        #resumen-carrito button:hover, #btn-login:hover, #btn-guardar-producto:hover, #btn-cancelar-edicion:hover, .btn-admin-categoria:hover {
            background-color: #FF69B4; /* ROSA M√ÅS OSCURO AL PASAR EL MOUSE */
        }

        /* Bot√≥n de vaciar carrito: Corregido para que funcione */
        #btn-vaciar-carrito {
            background-color: #DC143C !important;
            color: white !important; /* Asegurar que el texto se vea bien */
        }
        
        #btn-vaciar-carrito:hover {
            background-color: #B22222 !important;
        }

        /* PESTA√ëAS */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            background-color: var(--color-primario); /* LILA SUAVE */
            color: var(--color-texto);
            border: none;
            margin: 0 5px;
            border-radius: 5px;
            font-weight: bold;
        }

        .tab-button.active {
            background-color: var(--color-acento); /* ROSA PASTEL ACTIVO */
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* ADMINISTRACI√ìN */
        #admin-panel input[type="text"], 
        #admin-panel input[type="number"], 
        #admin-panel input[type="password"],
        #admin-panel select {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px 0;
            display: inline-block;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            box-sizing: border-box;
            color: var(--color-texto); /* Aseguramos que el texto de entrada sea negro */
            text-transform: uppercase;
        }

        #lista-admin-productos {
            margin-top: 20px;
        }

        .admin-producto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid var(--color-secundario); /* Borde lila */
            margin-bottom: 5px;
            border-radius: 4px;
            background-color: #E0FFFF; /* AZUL CIELO PASTEL */
        }

        .admin-producto-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 4px;
        }

        .admin-producto-info {
            flex-grow: 1;
        }

        .admin-producto-acciones button {
            margin-left: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            background-color: #F08080; /* ROJO CLARO */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .admin-producto-acciones button.btn-modificar {
            background-color: var(--color-secundario); /* LILA para modificar */
            color: var(--color-texto);
        }
        
        /* ESTILO PARA EL BUSCADOR */
        #buscador-admin {
            margin-bottom: 15px;
            padding: 10px;
            border: 2px solid var(--color-secundario);
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
            color: var(--color-texto); 
            text-transform: uppercase;
        }

        .lista-categorias-admin {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .categoria-tag {
            background-color: var(--color-primario); /* LILA SUAVE */
            color: var(--color-texto);
            padding: 5px 10px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }
        .categoria-tag button {
            background: none;
            border: none;
            color: var(--color-texto);
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            padding: 0;
            line-height: 1;
        }

        /* RESPONSIVE B√ÅSICO: HACE QUE SE VEA BIEN EN M√ìVILES */
        @media (max-width: 768px) {
            .producto-card {
                width: calc(50% - 10px); 
            }
            .carrito-item {
                flex-wrap: wrap;
                text-align: center;
            }
            .carrito-item input {
                margin: 5px 0;
            }
        }

        @media (max-width: 480px) {
            .producto-card {
                width: 100%; 
            }
            header h1 {
                font-size: 1.8em;
            }
            #resumen-carrito button {
                width: 100%;
                margin-top: 10px;
            }
        }
        
        /* ESTILO PARA MODAL DE CONFIRMACI√ìN (REEMPLAZA A alert/confirm) */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
        }

        .modal-content {
            background-color: var(--color-fondo);
            margin: 15% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            max-width: 400px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-content button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        #modal-confirm-yes {
            background-color: #5cb85c; /* Verde */
            color: white;
        }
        #modal-confirm-no {
            background-color: #f44336; /* Rojo */
            color: white;
        }
    </style>
</head>
<body>

    <!-- MODAL DE CONFIRMACI√ìN (Nuevo elemento para reemplazar a confirm()) -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <p id="modal-message">¬øEST√Å SEGURO DE REALIZAR ESTA ACCI√ìN?</p>
            <button id="modal-confirm-yes">S√ç</button>
            <button id="modal-confirm-no">NO</button>
        </div>
    </div>

    <header>
        <!-- T√≠tulo principal -->
        <h1>ACCESORIOS DE MODA Y M√ÅS</h1>
    </header>

    <main id="app-main">
        
        <!-- PESTA√ëAS DE NAVEGACI√ìN ENTRE TIENDA Y ADMIN -->
        <div class="tabs">
            <button class="tab-button active" onclick="mostrarPestana('tienda', event)">üõçÔ∏è TIENDA</button>
            <button class="tab-button" onclick="mostrarPestana('admin', event)">üîë ADMINISTRADOR</button>
        </div>

        <!-- CONTENIDO DE LA TIENDA -->
        <div id="tienda-panel" class="tab-content" style="display: block;">
            
            <!-- SECCI√ìN DE PRODUCTOS -->
            <section id="productos-seccion">
                <h2>üõçÔ∏è NUESTROS PRODUCTOS</h2>
                <!-- Los productos se cargar√°n aqu√≠ por JavaScript -->
            </section>

            <!-- SECCI√ìN DEL CARRITO -->
            <section id="carrito-seccion">
                <h2>üõí CARRITO DE COMPRAS</h2>
                <div id="lista-carrito">
                    <!-- Los items del carrito se cargar√°n aqu√≠ por JavaScript -->
                    <p>EL CARRITO EST√Å VAC√çO.</p>
                </div>
                <div id="resumen-carrito">
                    <!-- CORRECCI√ìN: El span siempre muestra un n√∫mero, incluso si es $0.00 -->
                    <p>TOTAL DE LA COMPRA: <span id="carrito-total">$0.00</span></p> 
                    <button id="btn-vaciar-carrito">VACIAR CARRITO</button>
                    <button id="btn-comprar-whatsapp">COMPRAR Y ENVIAR POR WHATSAPP</button>
                </div>
            </section>
        </div>


        <!-- CONTENIDO DEL ADMINISTRADOR -->
        <div id="admin-panel" class="tab-content" style="display: none;">
            <section id="login-seccion">
                <h2>üîê INGRESO DE ADMINISTRADOR</h2>
                <input type="password" id="admin-password" placeholder="INGRESE LA CLAVE DE ADMINISTRACI√ìN">
                <button id="btn-login">INGRESAR</button>
                <p id="mensaje-error" style="color: red; margin-top: 10px; display: none;">CLAVE INCORRECTA.</p>
            </section>

            <section id="gestion-productos" style="display: none;">
                
                <!-- GESTI√ìN DE CATEGOR√çAS -->
                <section id="gestion-categorias">
                    <h3>‚ûï GESTI√ìN DE CATEGOR√çAS</h3>
                    <form id="form-categoria">
                        <input type="text" id="nueva-categoria" placeholder="NOMBRE DE LA NUEVA CATEGOR√çA" required>
                        <button type="submit" class="btn-admin-categoria">A√ëADIR CATEGOR√çA</button>
                    </form>
                    <p style="margin-top: 15px;">CATEGOR√çAS ACTIVAS:</p>
                    <div id="lista-categorias-admin" class="lista-categorias-admin">
                        <!-- Las categor√≠as se cargar√°n aqu√≠ para visualizarlas y eliminarlas -->
                    </div>
                </section>


                <!-- FORMULARIO DE AGREGAR/MODIFICAR PRODUCTO -->
                <h3>‚úèÔ∏è AGREGAR O MODIFICAR PRODUCTO</h3>
                <form id="form-producto">
                    <input type="hidden" id="producto-id">
                    <input type="text" id="producto-nombre" placeholder="NOMBRE DEL PRODUCTO" required>
                    <input type="number" id="producto-precio" placeholder="PRECIO (EJ: 15.50)" step="0.01" required>
                    <!-- Nota: Se usa un placeholder para URL, pero puedes reemplazarlo con el nombre del archivo si lo subes -->
                    <input type="text" id="producto-foto" placeholder="URL DE LA FOTO (EJ: https://.../foto.jpg) o ARCHIVO" required>
                    <select id="producto-categoria" required>
                        <!-- Las opciones se cargar√°n din√°micamente aqu√≠ por JavaScript -->
                    </select>
                    <button type="submit" id="btn-guardar-producto">GUARDAR PRODUCTO</button>
                    <button type="button" id="btn-cancelar-edicion" style="display: none;">CANCELAR EDICI√ìN</button>
                </form>

                <!-- LISTA DE PRODUCTOS PARA MODIFICAR/ELIMINAR -->
                <h3>üìã LISTA DE PRODUCTOS (BUSCADOR Y ACCIONES)</h3>
                
                <!-- CAMPO DE B√öSQUEDA A√ëADIDO -->
                <input type="text" id="buscador-admin" placeholder="BUSCAR PRODUCTO POR NOMBRE...">

                <div id="lista-admin-productos">
                    <!-- Los productos se cargar√°n aqu√≠ por JavaScript y se filtrar√°n por el buscador -->
                </div>
                
            </section>
        </div>


    </main>

    <!-- L√ìGICA (JAVASCRIPT) -->
    <script>
        // =================================================================
        // 1. UTILIDADES Y GESTI√ìN DE DATOS (LOCALSTORAGE)
        // =================================================================

        // Categor√≠as de ejemplo iniciales (usadas solo si no hay nada guardado)
        const categoriasIniciales = ["BIJUTERI", "ACCESORIOS DE MUJER", "ACCESORIOS DE HOMBRE"];
        
        // Productos de ejemplo iniciales
        const productosIniciales = [
            // Se usa un placeholder gen√©rico. Reemplaza estas URLs con tus fotos reales.
            // Se actualizan los placeholders para que combinen con la nueva paleta de color
            { id: 1, nombre: "COLLAR DE PERLAS CL√ÅSICO", precio: 25.00, foto: "https://placehold.co/300x200/D8BFD8/000?text=COLLAR", categoria: "BIJUTERI" },
            { id: 2, nombre: "ARETES DE PLATA MINIMALISTAS", precio: 15.50, foto: "https://placehold.co/300x200/E6E0F8/000?text=ARETES", categoria: "BIJUTERI" },
            { id: 3, nombre: "PA√ëUELO ESTAMPADO FLORES", precio: 30.00, foto: "https://placehold.co/300x200/FFC0CB/000?text=PA√ëUELO", categoria: "ACCESORIOS DE MUJER" },
            { id: 4, nombre: "CARTERA DE MANO ELEGANTE", precio: 55.00, foto: "https://placehold.co/300x200/D8BFD8/000?text=CARTERA", categoria: "ACCESORIOS DE MUJER" },
            { id: 5, nombre: "RELOJ DEPORTIVO ACERO", precio: 80.99, foto: "https://placehold.co/300x200/E6E0F8/000?text=RELOJ", categoria: "ACCESORIOS DE HOMBRE" },
            { id: 6, nombre: "BILLETERA DE CUERO MARR√ìN", precio: 45.99, foto: "https://placehold.co/300x200/FFC0CB/000?text=BILLETERA", categoria: "ACCESORIOS DE HOMBRE" },
        ];

        let productos = JSON.parse(localStorage.getItem('productosMM')) || productosIniciales;
        let carrito = JSON.parse(localStorage.getItem('carritoMM')) || [];
        let categorias = JSON.parse(localStorage.getItem('categoriasMM')) || categoriasIniciales;
        const CLAVE_ADMIN = "MM2025"; 

        // Funci√≥n para guardar los productos en el navegador
        const guardarProductos = () => {
            // Ordenar alfab√©ticamente antes de guardar
            productos.sort((a, b) => a.nombre.localeCompare(b.nombre));
            localStorage.setItem('productosMM', JSON.stringify(productos));
        };

        // Funci√≥n para guardar el carrito
        const guardarCarrito = () => {
            localStorage.setItem('carritoMM', JSON.stringify(carrito));
        };

        // Nueva funci√≥n para guardar categor√≠as
        const guardarCategorias = () => {
             // Ordenar alfab√©ticamente
            categorias.sort();
            localStorage.setItem('categoriasMM', JSON.stringify(categorias));
        };

        // Funci√≥n de utilidad para mostrar mensajes en lugar de alert()
        const mostrarMensaje = (texto) => {
            const mensajeDiv = document.createElement('div');
            mensajeDiv.textContent = texto;
            mensajeDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px;
                background-color: var(--color-acento); color: white;
                padding: 15px; border-radius: 8px; z-index: 1000;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                text-transform: uppercase; font-weight: bold;
                animation: fadeout 3s forwards;
            `;
            document.body.appendChild(mensajeDiv);

            // Crear animaci√≥n de desvanecimiento
            const styleSheet = document.createElement("style");
            styleSheet.innerText = `@keyframes fadeout { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-20px); visibility: hidden; } }`;
            document.head.appendChild(styleSheet);

            setTimeout(() => {
                mensajeDiv.remove();
                styleSheet.remove();
            }, 3000);
        };
        
        // Funci√≥n para manejar la confirmaci√≥n (reemplazando a window.confirm)
        // Recibe el mensaje a mostrar y un callback para la acci√≥n S√ç/NO
        const mostrarConfirmacion = (mensaje, callback) => {
            const modal = document.getElementById('confirm-modal');
            const messageElement = document.getElementById('modal-message');
            const btnYes = document.getElementById('modal-confirm-yes');
            const btnNo = document.getElementById('modal-confirm-no');
            
            messageElement.textContent = mensaje;
            modal.style.display = 'block';

            // Remover listeners anteriores para evitar m√∫ltiples ejecuciones
            const newBtnYes = btnYes.cloneNode(true);
            btnYes.parentNode.replaceChild(newBtnYes, btnYes);

            const newBtnNo = btnNo.cloneNode(true);
            btnNo.parentNode.replaceChild(newBtnNo, btnNo);

            // Asignar nuevos listeners
            newBtnYes.addEventListener('click', () => {
                modal.style.display = 'none';
                callback(true); // Llamar al callback con 'true' (S√ç)
            }, { once: true }); // Ejecutar solo una vez

            newBtnNo.addEventListener('click', () => {
                modal.style.display = 'none';
                callback(false); // Llamar al callback con 'false' (NO)
            }, { once: true }); // Ejecutar solo una vez

            // Cerrar el modal al hacer click fuera
            modal.onclick = (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                    callback(false);
                }
            }
        };


        // =================================================================
        // 2. L√ìGICA DE LA TIENDA Y CARRITO
        // =================================================================

        const renderizarProductos = () => {
            const productosSeccion = document.getElementById('productos-seccion');
            if (!productosSeccion) return; 

            // Agrupar productos por categor√≠a
            const categoriasProductos = productos.reduce((acc, producto) => {
                const categoriaNombre = producto.categoria || 'SIN CATEGOR√çA'; // Manejar productos sin categor√≠a asignada
                if (!acc[categoriaNombre]) {
                    acc[categoriaNombre] = [];
                }
                acc[categoriaNombre].push(producto);
                return acc;
            }, {});

            // Renderizar cada secci√≥n
            let htmlContent = '<h2>üõçÔ∏è NUESTROS PRODUCTOS</h2>'; // Reinsertar el t√≠tulo principal de la secci√≥n
            // Crear un array de categor√≠as y ordenarlas
            const categoriasOrdenadas = Object.keys(categoriasProductos).sort(); 

            categoriasOrdenadas.forEach(categoria => {
                // Se ha quitado "SECCI√ìN: " y el emoji üíé
                htmlContent += `
                    <h3 class="categoria-titulo">${categoria}</h3>
                    <div class="contenedor-productos">
                `;
                
                // Renderizar productos dentro de la categor√≠a
                categoriasProductos[categoria].forEach(producto => {
                    htmlContent += `
                        <div class="producto-card">
                            <img src="${producto.foto}" alt="${producto.nombre}" onerror="this.onerror=null; this.src='https://placehold.co/300x200/D8BFD8/000?text=FOTO+NO+DISPONIBLE';">
                            <h4>${producto.nombre}</h4>
                            <p class="precio">$${producto.precio.toFixed(2)}</p>
                            <button data-id="${producto.id}" class="btn-agregar-carrito">AGREGAR AL CARRITO</button>
                        </div>
                    `;
                });

                htmlContent += `</div>`;
            });

            productosSeccion.innerHTML = htmlContent;

            // Asignar eventos a los botones de agregar al carrito
            document.querySelectorAll('.btn-agregar-carrito').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    agregarAlCarrito(id);
                });
            });
        };

        const agregarAlCarrito = (productoId) => {
            const itemEnCarrito = carrito.find(item => item.id === productoId);
            
            if (itemEnCarrito) {
                itemEnCarrito.cantidad++;
            } else {
                const producto = productos.find(p => p.id === productoId);
                if (producto) {
                    carrito.push({
                        id: producto.id,
                        nombre: producto.nombre,
                        precio: producto.precio,
                        cantidad: 1
                    });
                }
            }

            guardarCarrito();
            renderizarCarrito();
            mostrarMensaje(`"${productos.find(p => p.id === productoId).nombre}" AGREGADO AL CARRITO!`);
        };

        const renderizarCarrito = () => {
            const listaCarrito = document.getElementById('lista-carrito');
            const carritoTotalSpan = document.getElementById('carrito-total');
            if (!listaCarrito || !carritoTotalSpan) return;

            let total = 0;
            let htmlContent = '';

            if (carrito.length === 0) {
                htmlContent = '<p>EL CARRITO EST√Å VAC√çO.</p>';
                // CORRECCI√ìN: Si el carrito est√° vac√≠o, el total debe ser 0
                total = 0; 
            } else {
                carrito.forEach(item => {
                    const subtotal = item.precio * item.cantidad;
                    total += subtotal;

                    htmlContent += `
                        <div class="carrito-item">
                            <span class="item-nombre">${item.nombre}</span>
                            <span class="item-precio-individual">$${item.precio.toFixed(2)}</span>
                            <input type="number" min="1" value="${item.cantidad}" data-id="${item.id}" class="input-cantidad">
                            <span class="item-subtotal">SUBTOTAL: $${subtotal.toFixed(2)}</span>
                            <button data-id="${item.id}" class="btn-eliminar-item">X</button>
                        </div>
                    `;
                });
            }

            listaCarrito.innerHTML = htmlContent;
            // CORRECCI√ìN: El total siempre se muestra correctamente aqu√≠
            carritoTotalSpan.textContent = `$${total.toFixed(2)}`; 

            // Asignar eventos a los botones de eliminar y a los campos de cantidad
            document.querySelectorAll('.btn-eliminar-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    eliminarDelCarrito(parseInt(e.target.dataset.id));
                });
            });

            document.querySelectorAll('.input-cantidad').forEach(input => {
                input.addEventListener('change', (e) => {
                    // Asegurar que la cantidad sea un n√∫mero positivo
                    const nuevaCantidad = Math.max(1, parseInt(e.target.value) || 1);
                    e.target.value = nuevaCantidad; // Actualizar el input visualmente
                    actualizarCantidad(parseInt(e.target.dataset.id), nuevaCantidad);
                });
            });
        };

        const eliminarDelCarrito = (productoId) => {
            carrito = carrito.filter(item => item.id !== productoId);
            guardarCarrito();
            renderizarCarrito();
            mostrarMensaje("PRODUCTO ELIMINADO DEL CARRITO.");
        };

        const actualizarCantidad = (productoId, nuevaCantidad) => {
            const item = carrito.find(item => item.id === productoId);
            if (item && nuevaCantidad > 0) {
                item.cantidad = nuevaCantidad;
            } 
            guardarCarrito();
            renderizarCarrito();
        };

        // CORRECCI√ìN FINAL: Usamos el nuevo modal de confirmaci√≥n
        const vaciarCarrito = () => {
            if (carrito.length === 0) {
                 mostrarMensaje("EL CARRITO YA EST√Å VAC√çO.");
                 return;
            }
            
            // Usamos la funci√≥n de modal personalizada
            mostrarConfirmacion("¬øEST√Å SEGURO DE VACIAR TODO EL CARRITO?", (confirmado) => {
                if (confirmado) {
                    carrito = [];
                    guardarCarrito();
                    renderizarCarrito();
                    mostrarMensaje("CARRITO VACIADO.");
                }
            });
        };

        // CORRECCI√ìN: Se establece el n√∫mero de WhatsApp con instrucciones claras
        const generarMensajeWhatsApp = () => {
            if (carrito.length === 0) {
                mostrarMensaje("EL CARRITO EST√Å VAC√çO. AGREGA PRODUCTOS PARA CONTINUAR.");
                return;
            }

            let mensaje = "HOLA! QUISIERA REALIZAR EL SIGUIENTE PEDIDO DE ACCESORIOS DE MODA Y M√ÅS:\n\n";
            let total = 0;

            carrito.forEach(item => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;
                mensaje += `* ${item.nombre} (x${item.cantidad}) - SUBT: $${subtotal.toFixed(2)}\n`;
            });

            mensaje += `\nTOTAL DE LA COMPRA: $${total.toFixed(2)}`;
            mensaje += "\n\nPOR FAVOR, CONFIRMAR DISPONIBILIDAD Y MEDIO DE PAGO.";

            // ========================================================================
            // !!! INSTRUCCI√ìN IMPORTANTE: DEBES EDITAR ESTA L√çNEA !!!
            // Reemplaza '5493511234567' con tu n√∫mero real de WhatsApp (c√≥digo de pa√≠s + n√∫mero, sin signos + o espacios).
            const numeroTelefono = "5493511234567"; // N√öMERO DE EJEMPLO: 54 (Argentina) + 9 + 351 (C√≥rdoba) + N√∫mero
            // ========================================================================

            // Codificar el mensaje para la URL de WhatsApp
            const url = `https://wa.me/${numeroTelefono}?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        };


        // =================================================================
        // 3. L√ìGICA DE ADMINISTRACI√ìN
        // =================================================================
        
        // --- GESTI√ìN DE CATEGOR√çAS ---
        const renderizarSelectCategorias = (categoriaActual = '') => {
            const selectCategoria = document.getElementById('producto-categoria');
            if (!selectCategoria) return;

            let htmlOptions = '<option value="">SELECCIONE CATEGOR√çA</option>';
            
            // Renderiza las categor√≠as almacenadas
            categorias.forEach(cat => {
                const selected = cat === categoriaActual ? 'selected' : '';
                htmlOptions += `<option value="${cat}" ${selected}>${cat}</option>`;
            });

            selectCategoria.innerHTML = htmlOptions;
            renderizarListaAdminCategorias(); // Tambi√©n actualiza la lista en el admin
        };

        const renderizarListaAdminCategorias = () => {
            const listaAdmin = document.getElementById('lista-categorias-admin');
            if (!listaAdmin) return;
            
            let htmlContent = '';
            categorias.forEach(cat => {
                htmlContent += `
                    <div class="categoria-tag">
                        ${cat}
                        <button data-cat="${cat}" class="btn-eliminar-categoria">X</button>
                    </div>
                `;
            });
            listaAdmin.innerHTML = htmlContent;

            // Asignar eventos a los botones de eliminar
            document.querySelectorAll('.btn-eliminar-categoria').forEach(button => {
                button.addEventListener('click', (e) => {
                    eliminarCategoria(e.target.dataset.cat);
                });
            });
        };

        const gestionarFormularioCategoria = (e) => {
            e.preventDefault();
            const inputCategoria = document.getElementById('nueva-categoria');
            const nuevaCat = inputCategoria.value.trim().toUpperCase();

            if (!nuevaCat) {
                mostrarMensaje("EL NOMBRE DE LA CATEGOR√çA NO PUEDE ESTAR VAC√çO.");
                return;
            }

            if (categorias.includes(nuevaCat)) {
                mostrarMensaje(`LA CATEGOR√çA "${nuevaCat}" YA EXISTE.`);
                return;
            }

            categorias.push(nuevaCat);
            guardarCategorias();
            renderizarSelectCategorias(); // Actualiza el dropdown y la lista admin
            inputCategoria.value = '';
            mostrarMensaje(`CATEGOR√çA AGREGADA: ${nuevaCat}`);
        };

        const eliminarCategoria = (catAEliminar) => {
            // Verificar si hay productos asignados a esta categor√≠a
            const productosAsignados = productos.filter(p => p.categoria === catAEliminar).length;

            let mensajeConfirmacion = `¬øEST√Å SEGURO DE ELIMINAR LA CATEGOR√çA "${catAEliminar}"?`;
            if (productosAsignados > 0) {
                mensajeConfirmacion += `\n\nATENCI√ìN: HAY ${productosAsignados} PRODUCTOS ASIGNADOS A ESTA CATEGOR√çA. DEBER√Å REASIGNARLOS MANUALMENTE DESPU√âS.`;
            }
            
            // Usamos la funci√≥n de modal personalizada
            mostrarConfirmacion(mensajeConfirmacion, (confirmado) => {
                if (confirmado) {
                    // Filtrar la categor√≠a a eliminar
                    categorias = categorias.filter(cat => cat !== catAEliminar);
                    guardarCategorias();

                    // Quitar la categor√≠a de los productos existentes para evitar errores
                    productos.forEach(p => {
                        if (p.categoria === catAEliminar) {
                            p.categoria = ''; // Deja la categor√≠a vac√≠a para que se reasigne
                        }
                    });
                    guardarProductos(); // Guarda la actualizaci√≥n de productos

                    renderizarSelectCategorias(); 
                    // Re-renderizar la lista de productos en el admin con el filtro actual (si lo hay)
                    filtrarYRenderizarProductos(); 
                    renderizarProductos(); // Actualizar la vista de la tienda
                    mostrarMensaje(`CATEGOR√çA ELIMINADA: ${catAEliminar}`);
                }
            });
        };
        // --- FIN GESTI√ìN DE CATEGOR√çAS ---


        // Funci√≥n que aplica el filtro de b√∫squeda y renderiza
        const filtrarYRenderizarProductos = () => {
            const listaAdmin = document.getElementById('lista-admin-productos');
            const buscadorInput = document.getElementById('buscador-admin');
            if (!listaAdmin || !buscadorInput) return; 

            const terminoBusqueda = buscadorInput.value.trim().toUpperCase();
            
            // Filtrar los productos
            const productosFiltrados = productos.filter(producto => {
                // Incluye el producto si su nombre contiene el t√©rmino de b√∫squeda
                return producto.nombre.includes(terminoBusqueda);
            });

            let htmlContent = '';

            if (productosFiltrados.length === 0 && terminoBusqueda.length > 0) {
                htmlContent = `<p style="text-align: center; color: #DC143C;">NO SE ENCONTRARON PRODUCTOS CON EL NOMBRE "${terminoBusqueda}".</p>`;
            } else {
                 // Renderizar productos filtrados
                productosFiltrados.forEach(producto => {
                    htmlContent += `
                        <div class="admin-producto-item" data-id="${producto.id}" data-categoria="${producto.categoria}">
                            <img src="${producto.foto}" alt="${producto.nombre}" onerror="this.onerror=null; this.src='https://placehold.co/50x50/D8BFD8/000?text=SIN+FOTO';">
                            <div class="admin-producto-info">
                                <p><strong>ID: ${producto.id}</strong> | ${producto.nombre}</p>
                                <p>PRECIO: $${producto.precio.toFixed(2)} | CATEGOR√çA: ${producto.categoria || 'SIN CATEGOR√çA'}</p>
                            </div>
                            <div class="admin-producto-acciones">
                                <button data-id="${producto.id}" class="btn-modificar">MODIFICAR</button>
                                <button data-id="${producto.id}" class="btn-eliminar">ELIMINAR</button>
                            </div>
                        </div>
                    `;
                });
            }

            listaAdmin.innerHTML = htmlContent;

            // Asignar eventos a los botones de Modificar y Eliminar a los productos filtrados
            document.querySelectorAll('.btn-modificar').forEach(button => {
                button.addEventListener('click', (e) => {
                    cargarProductoParaEdicion(parseInt(e.target.dataset.id));
                });
            });
            document.querySelectorAll('.btn-eliminar').forEach(button => {
                button.addEventListener('click', (e) => {
                    eliminarProducto(parseInt(e.target.dataset.id));
                });
            });
        };


        const gestionarFormularioProducto = (e) => {
            e.preventDefault();

            const id = document.getElementById('producto-id').value;
            const nombre = document.getElementById('producto-nombre').value.trim().toUpperCase();
            const precio = parseFloat(document.getElementById('producto-precio').value);
            const foto = document.getElementById('producto-foto').value.trim();
            const categoria = document.getElementById('producto-categoria').value;

            if (!nombre || isNaN(precio) || precio <= 0 || !foto || !categoria) {
                mostrarMensaje("POR FAVOR, COMPLETE TODOS LOS CAMPOS CORRECTAMENTE (INCLUYENDO LA CATEGOR√çA).");
                return;
            }

            if (id) {
                // MODIFICAR PRODUCTO
                const index = productos.findIndex(p => p.id === parseInt(id));
                if (index !== -1) {
                    productos[index] = { id: parseInt(id), nombre, precio, foto, categoria };
                    mostrarMensaje(`PRODUCTO MODIFICADO: ${nombre}`);
                }
            } else {
                // AGREGAR NUEVO PRODUCTO
                const nuevoId = productos.length > 0 ? Math.max(...productos.map(p => p.id)) + 1 : 1;
                productos.push({ id: nuevoId, nombre, precio, foto, categoria });
                mostrarMensaje(`PRODUCTO AGREGADO: ${nombre}`);
            }

            guardarProductos();
            // Re-renderizar la lista de productos en el admin con el filtro actual (si lo hay)
            filtrarYRenderizarProductos(); 
            limpiarFormulario();
            // Asegurarse de que la tienda se actualice si est√° visible
            renderizarProductos(); 
        };

        const cargarProductoParaEdicion = (id) => {
            const producto = productos.find(p => p.id === id);
            if (producto) {
                document.getElementById('producto-id').value = producto.id;
                document.getElementById('producto-nombre').value = producto.nombre;
                document.getElementById('producto-precio').value = producto.precio;
                document.getElementById('producto-foto').value = producto.foto;
                // Cargar la categor√≠a actual en el select
                renderizarSelectCategorias(producto.categoria);
                
                document.getElementById('btn-guardar-producto').textContent = 'GUARDAR CAMBIOS';
                document.getElementById('btn-cancelar-edicion').style.display = 'inline-block';
                window.scrollTo(0, 0); // Ir arriba al formulario
            }
        };

        const limpiarFormulario = () => {
            document.getElementById('form-producto').reset();
            document.getElementById('producto-id').value = '';
            document.getElementById('btn-guardar-producto').textContent = 'GUARDAR PRODUCTO';
            document.getElementById('btn-cancelar-edicion').style.display = 'none';
            // Volver a renderizar el select sin selecci√≥n
            renderizarSelectCategorias(); 
        };

        const eliminarProducto = (id) => {
            // Usar una confirmaci√≥n visual
            mostrarConfirmacion("¬øEST√Å SEGURO DE ELIMINAR ESTE PRODUCTO? ESTA ACCI√ìN NO SE PUEDE DESHACER.", (confirmado) => {
                if (confirmado) {
                    productos = productos.filter(p => p.id !== id);
                    guardarProductos();
                    // Re-renderizar la lista de productos en el admin con el filtro actual (si lo hay)
                    filtrarYRenderizarProductos(); 
                    renderizarProductos(); // Actualizar la vista de la tienda
                    mostrarMensaje("PRODUCTO ELIMINADO.");
                }
            });
        };

        const iniciarSesionAdmin = () => {
            const inputPassword = document.getElementById('admin-password');
            const password = inputPassword.value.trim();
            const mensajeError = document.getElementById('mensaje-error');
            
            if (password === CLAVE_ADMIN) {
                document.getElementById('login-seccion').style.display = 'none';
                document.getElementById('gestion-productos').style.display = 'block';
                mensajeError.style.display = 'none';
                // Usar la funci√≥n de filtro para cargar la lista inicial
                filtrarYRenderizarProductos(); 
                renderizarSelectCategorias(); // Cargar categor√≠as al ingresar
            } else {
                mensajeError.style.display = 'block';
                inputPassword.value = '';
            }
        };

        // Funci√≥n para cambiar entre pesta√±as
        const mostrarPestana = (pestanaId, event) => {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`${pestanaId}-panel`).style.display = 'block';

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            if(event && event.target) {
                event.target.classList.add('active');
            }

            // Si cambiamos a la tienda, aseguramos la recarga del carrito
            if (pestanaId === 'tienda') {
                renderizarCarrito();
            }
        }


        // =================================================================
        // 4. INICIALIZACI√ìN
        // =================================================================

        window.onload = () => {
            // 1. Asegurarse de que los productos y categor√≠as iniciales est√©n ordenados y guardados
            guardarCategorias();
            guardarProductos(); 
            
            // 2. Inicializar la vista de la tienda
            renderizarProductos();
            renderizarCarrito();

            // 3. Asignar eventos de la tienda
            const btnVaciar = document.getElementById('btn-vaciar-carrito');
            if (btnVaciar) {
                btnVaciar.addEventListener('click', vaciarCarrito);
            } else {
                console.error("ERROR: No se encontr√≥ el bot√≥n 'btn-vaciar-carrito' para asignar el evento.");
            }
            
            const btnComprar = document.getElementById('btn-comprar-whatsapp');
            if (btnComprar) {
                btnComprar.addEventListener('click', generarMensajeWhatsApp);
            } else {
                console.error("ERROR: No se encontr√≥ el bot√≥n 'btn-comprar-whatsapp' para asignar el evento.");
            }


            // 4. Asignar eventos del administrador (independiente de si est√° visible)
            const btnLogin = document.getElementById('btn-login');
            if(btnLogin) btnLogin.addEventListener('click', iniciarSesionAdmin);

            const formProducto = document.getElementById('form-producto');
            if(formProducto) formProducto.addEventListener('submit', gestionarFormularioProducto);

            const btnCancelarEdicion = document.getElementById('btn-cancelar-edicion');
            if(btnCancelarEdicion) btnCancelarEdicion.addEventListener('click', limpiarFormulario);

            const formCategoria = document.getElementById('form-categoria');
            if(formCategoria) formCategoria.addEventListener('submit', gestionarFormularioCategoria);
            
            // 5. Asignar evento al nuevo buscador
            const buscadorAdmin = document.getElementById('buscador-admin');
            // Usamos 'input' para que filtre inmediatamente al escribir
            if(buscadorAdmin) buscadorAdmin.addEventListener('input', filtrarYRenderizarProductos);
            
            // Inicializar la lista de categor√≠as visibles en el admin (incluso antes de loguearse)
            renderizarListaAdminCategorias(); 
        };
    </script>
</body>
</html>